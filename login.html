<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SovaCore | Access Portal</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body {
            background: #050505;
            color: white;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body.light-mode {
            background: #f0f2f5;
            color: #333;
        }
        .light-mode .bg-gray-900 {
            background-color: #ffffff;
            border-color: #e5e7eb;
        }
        .light-mode .border-gray-800 {
            border-color: #e5e7eb;
        }
        .light-mode .bg-black {
            background-color: #f9fafb;
            color: #111827;
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen px-4">

    <!-- THEME TOGGLE -->
    <div class="absolute top-4 right-4 flex items-center gap-2">
        <span class="text-xs text-gray-500">Dark</span>
        <input type="checkbox" id="theme-toggle">
        <span class="text-xs text-gray-500">Light</span>
    </div>

    <!-- LOGIN CARD -->
    <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 w-full max-w-md shadow-2xl">

        <div class="text-center mb-8">
            <h1 class="text-2xl font-bold font-mono tracking-tighter">
                SOVA<span class="text-cyan-400">CORE</span>
            </h1>
            <p class="text-gray-500 text-sm mt-2">Access the Ambassador Portal</p>
        </div>

        <!-- GOOGLE LOGIN -->
        <button onclick="signInWithGoogle()" class="w-full flex items-center justify-center gap-3 bg-white text-black py-3 rounded-lg font-semibold hover:bg-gray-200 transition mb-6">
            <img src="https://www.svgrepo.com/show/355037/google.svg" class="w-5 h-5">
            Continue with Google
        </button>

        <div class="flex items-center my-6">
            <div class="flex-grow border-t border-gray-800"></div>
            <span class="mx-4 text-gray-500 text-xs">OR EMAIL</span>
            <div class="flex-grow border-t border-gray-800"></div>
        </div>

        <!-- EMAIL LOGIN -->
        <form onsubmit="handleEmailLogin(event)" class="space-y-4">
            <input id="email" type="email" placeholder="Email Address" required
                class="w-full bg-black border border-gray-800 p-3 rounded-lg outline-none focus:border-cyan-400">

            <input id="password" type="password" placeholder="Password" required
                class="w-full bg-black border border-gray-800 p-3 rounded-lg outline-none focus:border-cyan-400">

            <button class="w-full bg-cyan-500 text-black font-bold py-3 rounded-lg hover:bg-cyan-400 transition">
                PROCEED TO CORE
            </button>
        </form>

        <p class="text-center text-gray-500 text-xs mt-6">
            Don't have an account? <a href="#" class="text-cyan-400 hover:underline">Apply here</a>
        </p>
    </div>

<script>
/* ================= SUPABASE ================= */
const supabaseUrl = 'https://xhmsqsooabpcysacaroc.supabase.co';
const supabaseKey = 'YOUR_ANON_KEY_HERE';
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

/* ================= AUTH STATE LISTENER ================= */
supabaseClient.auth.onAuthStateChange(async (event, session) => {
    if (event === 'SIGNED_IN' && session) {

        const email = session.user.email;

        const { data: admin } = await supabaseClient
            .from('authorized_admins')
            .select('email')
            .eq('email', email)
            .single();

        if (admin) {
            window.location.href = 'admin.html';
        } else {
            alert('ACCESS DENIED');
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        }
    }
});

/* ================= EMAIL LOGIN ================= */
async function handleEmailLogin(event) {
    event.preventDefault();

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    const { error } = await supabaseClient.auth.signInWithPassword({
        email,
        password
    });

    if (error) {
        alert(error.message);
    }
}

/* ================= GOOGLE LOGIN ================= */
async function signInWithGoogle() {
    await supabaseClient.auth.signInWithOAuth({
        provider: 'google',
        options: {
            redirectTo: window.location.origin + '/amin.html'
        }
    });
}

/* ================= THEME TOGGLE ================= */
const toggle = document.getElementById('theme-toggle');
toggle.addEventListener('change', () => {
    document.body.classList.toggle('light-mode', toggle.checked);
});
</script>

</body>
</html>
